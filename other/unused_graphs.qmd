---
title: "unused cool graphs"
author: "Robert Ford"
format: pdf
editor: visual
---


```{r incident-type}
#| message: false
#| echo: false
#| warning: false
#| fig-cap: Delay Incidence by Month
#| fig-align: center
# Prepare the data: calculate the percentage of incidents by type for each vehicle
data_incident_percentage <- data %>%
  group_by(vehicle, Incident) %>%
  summarise(incident_count = n(), .groups = 'drop') %>%
  group_by(vehicle) %>%
  mutate(percentage = (incident_count / sum(incident_count)) * 100)

# Lump incidents making up less than 5% into "Other"
data_incident_percentage <- data_incident_percentage %>%
  mutate(Incident = ifelse(percentage < 5, "Other", Incident)) %>%
  group_by(vehicle, Incident) %>%
  summarise(incident_count = sum(incident_count), percentage = sum(percentage), .groups = 'drop')

# Function to create doughnut chart for a specific vehicle
create_doughnut_chart <- function(vehicle_type) {
  # Filter data for the specific vehicle type
  vehicle_data <- data_incident_percentage %>%
    filter(vehicle == vehicle_type)
  
  # Create the doughnut chart
  ggplot(vehicle_data, aes(x = 2, y = percentage, fill = Incident)) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar(theta = "y") +
    xlim(0.5, 2.5) +  # Adjust the x-axis limits to create the doughnut shape
    geom_text(aes(label = paste0(Incident, "\n", round(percentage, 1), "%")), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = paste("Incident Distribution for", vehicle_type)) +
    theme_void() +  # Clean theme for the doughnut chart
    theme(legend.position = "none")  # Hide the legend for a cleaner look
}

# Create doughnut charts for each vehicle type
bus_doughnut <- create_doughnut_chart("Bus")
streetcar_doughnut <- create_doughnut_chart("Streetcar")
subway_doughnut <- create_doughnut_chart("Subway")

# Arrange the charts side by side
bus_doughnut + streetcar_doughnut + subway_doughnut


```


```{r}
# Step 1: Calculate the average delay per incident by time and vehicle type
data_avg_delay_time <- data %>%
  mutate(year_month = as.Date(format(Date, "%Y-%m-01"))) %>%  # Convert date to year-month
  group_by(year_month, vehicle) %>%
  summarise(avg_delay = mean(Delay, na.rm = TRUE), .groups = 'drop')

# Step 2: Create the line graph with 3 lines for each transport mode
ggplot(data_avg_delay_time, aes(x = year_month, y = avg_delay, color = vehicle, group = vehicle)) +
  geom_line(size = 1) +
  labs(title = "Average Delay Time per Incident by Transport Mode (2014 - 2024)", 
       x = "Time (Year-Month)", y = "Average Delay (Minutes)", color = "Transport Mode") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```